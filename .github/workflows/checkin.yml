name: AnyRouter è‡ªåŠ¨ç­¾åˆ°
on:
  schedule:
    - cron: '0 */12 * * *'
  workflow_dispatch:

jobs:
  checkin:
    runs-on: ubuntu-latest
    environment: production
    env:
      PYTHONIOENCODING: utf-8
      # ä»“åº“å¯è§æ€§ï¼Œç”¨äºéšç§æ§åˆ¶
      REPO_VISIBILITY: ${{ github.event.repository.visibility }}
      # æ—¶åŒºè®¾ç½®ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º Asia/Shanghai ä¸­å›½æ—¶åŒºï¼‰
      TZ: ${{ secrets.TZ }}
      # æ—¶é—´æˆ³æ ¼å¼ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º %Y-%m-%d %H:%M:%Sï¼‰
      TIMESTAMP_FORMAT: ${{ secrets.TIMESTAMP_FORMAT }}
      # è´¦å·é…ç½®
      ANYROUTER_ACCOUNTS: ${{ secrets.ANYROUTER_ACCOUNTS }}
      # æ˜¯å¦æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯
      SHOW_SENSITIVE_INFO: ${{ secrets.SHOW_SENSITIVE_INFO }}
      # é€šçŸ¥é…ç½®
      DINGTALK_NOTIF_CONFIG: ${{ secrets.DINGTALK_NOTIF_CONFIG }}
      EMAIL_NOTIF_CONFIG: ${{ secrets.EMAIL_NOTIF_CONFIG }}
      PUSHPLUS_NOTIF_CONFIG: ${{ secrets.PUSHPLUS_NOTIF_CONFIG }}
      SERVERPUSH_NOTIF_CONFIG: ${{ secrets.SERVERPUSH_NOTIF_CONFIG }}
      FEISHU_NOTIF_CONFIG: ${{ secrets.FEISHU_NOTIF_CONFIG }}
      WECOM_NOTIF_CONFIG: ${{ secrets.WECOM_NOTIF_CONFIG }}
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ”§ å®‰è£… Mise
        uses: jdx/mise-action@v3
        with:
          cache_key: "{{default}}-${{ hashFiles('pyproject.toml') }}"

      - name: âš™ï¸ å®‰è£…ä¾èµ–
        run: mise run install

      - name: ğŸ­ é…ç½® Playwright ç¯å¢ƒ
        uses: ./.github/actions/setup-playwright
        id: playwright-setup

      - name: ğŸ’¾ æ¢å¤ä½™é¢å†å²ç¼“å­˜
        uses: actions/cache@v4
        with:
          path: balance_hash.txt
          key: balance-hash-${{ github.run_id }}
          restore-keys: |
            balance-hash-

      - name: ğŸš€ æ‰§è¡Œç­¾åˆ°ä»»åŠ¡
        run: mise run checkin
